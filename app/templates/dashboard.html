{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint == 'main.dashboard' %}active{% endif %}" 
               href="{{ url_for('main.dashboard') }}">
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint == 'main.customers' %}active{% endif %}" 
               href="{{ url_for('main.customers') }}">
              Customers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.endpoint == 'main.activities' %}active{% endif %}" 
               href="{{ url_for('main.activities') }}">
              Activities
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('auth.logout') }}">
              Logout
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <h2 class="mt-4">Welcome, {{ current_user.username }}!</h2>

      <h3 class="mt-4">Customers</h3>
      {% if customers %}
      <ul class="list-group">
        {% for customer in customers %}
        <li class="list-group-item">
          <strong>{{ customer.name }}</strong> - {{ customer.email }}
          {% if customer.activities %}
          <ul>
            {% for act in customer.activities %}
            <li>
              {{ act.text }} (by {{ act.creator.username }} at {{ act.timestamp.strftime('%Y-%m-%d %H:%M') }})
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>No activities yet.</p>
          {% endif %}
          <div class="mt-1">
            <a href="{{ url_for('main.edit_customer', customer_id=customer.id) }}">Edit</a> |
            <a href="{{ url_for('main.delete_customer', customer_id=customer.id) }}" 
               onclick="return confirm('Are you sure?');">Delete</a>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No customers yet.</p>
      {% endif %}

      <div class="mt-3">
        <a href="{{ url_for('main.add_customer') }}" class="btn btn-primary">Add New Customer</a>
      </div>

      {% with messages = get_flashed_messages() %}
      {% if messages %}
      <ul class="alert alert-info mt-2">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% endwith %}
    </main>
  </div>
</div>
{% endblock %}
