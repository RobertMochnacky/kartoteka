{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Welcome, {{ current_user.username }}!</h2>

<h3 class="mt-4">Recent Customers</h3>
{% if customers %}
<ul class="list-group mb-4">
    {% for customer in customers %}
    <li class="list-group-item">
        <strong>{{ customer.name }}</strong> - {{ customer.email }}<br>
        <small>Phone: {{ customer.phone }} | Address: {{ customer.address }}</small>
        <div class="mt-1">
            <a href="{{ url_for('main.view_customer', customer_id=customer.id) }}">View</a> |
            <a href="{{ url_for('main.edit_customer', customer_id=customer.id) }}">Edit</a>
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No customers yet.</p>
{% endif %}

<h3 class="mt-4">Recent Activities</h3>

<!-- Dropdown to select how many recent activities to show -->
<form method="get" class="mb-3">
    <label for="recent_limit" class="form-label">Show last:</label>
    <select name="recent_limit" id="recent_limit" class="form-select w-auto d-inline" onchange="this.form.submit()">
        {% for n in [5,10,15,20,30] %}
            <option value="{{ n }}" {% if n == recent_limit %}selected{% endif %}>{{ n }}</option>
        {% endfor %}
    </select>
</form>

{% if activities %}
<ul class="list-group">
    {% for act in activities %}
    <li class="list-group-item">
        <strong>{{ act.customer.name }}</strong> - {{ act.text }}
        <br>
        <small class="text-muted">
            Added by {{ act.creator.username }} at {{ act.timestamp.strftime('%Y-%m-%d %H:%M') }}
        </small>
    </li>
    {% endfor %}
</ul>
<a href="{{ url_for('main.activities') }}" class="btn btn-primary mt-3">View All Activities</a>
{% else %}
<p>No recent activities.</p>
{% endif %}
{% endblock %}
