{% extends "base.html" %}

{% block title %}{{ _("Customers") }}{% endblock %}

{% block content %}

<h2 class="mb-4">{{ _("Customers") }}</h2>

<!-- Card Wrapper -->
<div class="card rounded-0 mb-4">
  <div class="card-body">

    <!-- Search input -->
    <div class="mb-3">
      <input type="text" id="customerSearch" class="form-control rounded-0" placeholder="{{ _('Search customers...') }}">
    </div>

    <ul class="list-group mt-3" id="customerList">
      {% for customer in customers %}
      <li class="list-group-item rounded-0 d-flex justify-content-between align-items-center">
        <div class="customer-info">
          <strong>{{ customer.name }}</strong> — {{ _("Email") }}: {{ customer.email }} | 
          {{ _("Phone") }}: {{ customer.phone }} | {{ _("Address") }}: {{ customer.address }}
        </div>
        <div class="d-flex gap-2">
          <a href="{{ url_for('main.view_customer', customer_id=customer.id) }}" class="btn btn-outline-primary btn-sm rounded-0">{{ _("View") }}</a>
          <a href="{{ url_for('main.edit_customer', customer_id=customer.id) }}" class="btn btn-outline-warning btn-sm rounded-0">{{ _("Edit") }}</a>
          <a href="{{ url_for('main.delete_customer', customer_id=customer.id) }}" 
             class="btn btn-outline-danger btn-sm rounded-0" onclick="return confirm('{{ _('Are you sure?') }}');">{{ _("Delete") }}</a>
        </div>
      </li>
      {% endfor %}
    </ul>

    <div class="mt-4">
      <a href="{{ url_for('main.add_customer') }}" class="btn btn-primary rounded-0">{{ _("Add New Customer") }}</a>
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary rounded-0">{{ _("Back to Dashboard") }}</a>
    </div>

  </div>
</div>

<script>
const searchInput = document.getElementById("customerSearch");
const customerList = document.getElementById("customerList");

searchInput.addEventListener("input", function() {
  const query = this.value.trim();

  fetch(`/search_customers?q=${encodeURIComponent(query)}`)
    .then(res => res.json())
    .then(customers => {
      customerList.innerHTML = "";

      if (customers.length === 0) {
        customerList.innerHTML = "<li class='list-group-item rounded-0'>{{ _('No customers found.') }}</li>";
        return;
      }

      customers.forEach(c => {
        const li = document.createElement("li");
        li.className = "list-group-item rounded-0 d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <div class="customer-info">
            <strong>${c.name}</strong> — ${c.email}<br>
            <small>{{ _('Phone') }}: ${c.phone} | {{ _('Address') }}: ${c.address}</small>
          </div>
          <div class="d-flex gap-2">
            <a href="/customer/${c.id}" class="btn btn-outline-primary btn-sm rounded-0">{{ _('View') }}</a>
            <a href="/edit_customer/${c.id}" class="btn btn-outline-warning btn-sm rounded-0">{{ _('Edit') }}</a>
            <a href="/delete_customer/${c.id}" class="btn btn-outline-danger btn-sm rounded-0" onclick="return confirm('{{ _('Are you sure?') }}');">{{ _('Delete') }}</a>
          </div>
        `;
        customerList.appendChild(li);
      });
    });
});
</script>

{% endblock %}
