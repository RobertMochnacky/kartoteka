{% extends "base.html" %}
{% block title %}Settings{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h2 class="mb-4"><i class="bi bi-gear-fill me-2"></i>Settings</h2>

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white fw-semibold"><i class="bi bi-palette me-2 text-primary"></i>Appearance</div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="darkModeToggle" {% if localStorage.getItem('theme')=='dark' %}checked{% endif %}>
            <label class="form-check-label" for="darkModeToggle">Enable dark mode</label>
          </div>

          <div class="mb-3">
            <label for="accentColor" class="form-label">Accent color</label>
            <input type="color" id="accentColor" class="form-control form-control-color" value="{{ current_user.primary_color or '#3a86ff' }}">
          </div>
        </div>
      </div>

      <button id="saveSettings" class="btn btn-primary"><i class="bi bi-save me-1"></i> Save Preferences</button>
    </div>
  </div>
</div>

<script>
const darkToggle=document.getElementById("darkModeToggle");
const accentPicker=document.getElementById("accentColor");
const root=document.documentElement;

function applyAccent(color){root.style.setProperty("--primary-color",color);}
if(accentPicker.value){applyAccent(accentPicker.value);}

darkToggle.addEventListener("change",()=>{if(darkToggle.checked){document.body.classList.add("dark-mode");localStorage.setItem("theme","dark");}else{document.body.classList.remove("dark-mode");localStorage.setItem("theme","light");}});

document.getElementById("saveSettings").addEventListener("click",async()=>{
    const color=accentPicker.value;
    applyAccent(color);
    const res=await fetch("{{ url_for('main.save_user_settings') }}",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({primary_color:color})
    });
    const data=await res.json();
    if(data.success){
        const toast=document.createElement("div");
        toast.className="alert alert-success mt-3";
        toast.innerText="âœ… Settings saved!";
        document.querySelector(".container-fluid").prepend(toast);
        setTimeout(()=>toast.remove(),2000);
    }
});
</script>
{% endblock %}
